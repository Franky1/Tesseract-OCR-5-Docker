name: Linter

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main
  # call workflow from other workflow
  workflow_call:
    inputs:
      BRANCH:
        required: true
        type: string
        default: 'main'
  # manually trigger the workflow
  workflow_dispatch:
    inputs:
      BRANCH:
        required: true
        type: string
        description: The github branch to pull from
        default: 'main'

jobs:
  Linter:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v5.0.0
        with:
          fetch-depth: 0  # Shallow clones should be disabled for a better analysis

      - name: Lint Code Base
        uses: github/super-linter/slim@v7
        env:
          # Determine the correct base branch:
          # - For pull_request events: use the PR base (e.g., 'main')
          # - Else: prefer provided input BRANCH, then repo default, then 'main'
          DEFAULT_BRANCH: ${{ github.event_name == 'pull_request' && github.event.pull_request.base.ref || inputs.BRANCH || github.event.repository.default_branch || 'main' }}
          VALIDATE_ALL_CODEBASE: true
          VALIDATE_MARKDOWN: true
          VALIDATE_DOCKERFILE: true
          VALIDATE_PYTHON: true
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
